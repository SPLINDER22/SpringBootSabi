<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de Rutinas</title>
    <style>
        .action-buttons { display:flex; flex-wrap:wrap; align-items:center; gap:0.4rem; }
        .action-buttons form { display:inline-block; margin:0; }
        .action-buttons .btn i { margin-right:.25rem; }

        /* Encabezado con gradiente más suave */
        .rutinas-header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(94, 114, 228, 0.25);
        }

        .rutinas-header h1 {
            color: #fff;
            margin: 0;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Tabla mejorada */
        .table-rutinas {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .table-rutinas thead {
            background: linear-gradient(90deg, #5e72e4 0%, #825ee4 100%);
        }

        .table-rutinas thead th {
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            border: none;
            padding: 1rem 0.75rem;
            background: transparent;
        }

        .table-rutinas tbody tr {
            transition: all 0.3s ease;
            border-bottom: 1px solid #e9ecef;
        }

        .table-rutinas tbody tr:hover {
            background: #f8f9fe;
            transform: translateX(4px);
            box-shadow: -4px 0 0 #5e72e4;
        }

        .table-rutinas tbody td {
            padding: 1rem 0.75rem;
            vertical-align: middle;
        }

        /* Badge para objetivo */
        .objetivo-badge {
            display: inline-block;
            padding: 0.4rem 0.85rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .objetivo-fuerza {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #fff;
        }

        .objetivo-hipertrofia {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #fff;
        }

        .objetivo-resistencia {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #fff;
        }

        .objetivo-perdida {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #fff;
        }

        .objetivo-default {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        /* Columna nombre destacada */
        .rutina-nombre {
            font-weight: 600;
            color: #5e72e4;
            font-size: 1.05rem;
        }

        /* Número de semanas con icono */
        .semanas-count {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            font-weight: 600;
            color: #d84315;
        }

        /* Botones mejorados */
        .btn-ver-semanas {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            border: none;
            color: #fff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-ver-semanas:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(94, 114, 228, 0.4);
        }

        .btn-editar-rutina {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            color: #fff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-editar-rutina:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }

        .btn-asignar-rutina {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border: none;
            color: #fff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-asignar-rutina:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
        }

        .btn-eliminar-rutina {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            color: #fff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-eliminar-rutina:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);
        }

        .btn-adoptar-rutina {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: none;
            color: #d84315 !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-adoptar-rutina:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(252, 182, 159, 0.4);
        }

        .btn-crear-rutina {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border: none;
            color: #fff !important;
            font-weight: 600;
            padding: 0.6rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
        }

        .btn-crear-rutina:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.5);
        }

        /* Alertas mejoradas */
        .alert-custom {
            border-radius: 12px;
            border: none;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .alert-warning-custom {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #d84315;
        }

        .alert-info-custom {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        .alert-success-custom {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #fff;
        }

        /* Mensaje sin rutinas */
        .no-rutinas-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #5e72e4;
        }

        .no-rutinas-message i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body th:replace="layout/layout :: layout('Lista de rutinas', ~{::section})">
<section th:fragment="section">
    <div th:if="${modoAsignar == null or !modoAsignar}" class="rutinas-header">
        <h1><i class="fas fa-dumbbell"></i> Mis Rutinas de Entrenamiento</h1>
    </div>

    <div th:if="${modoAsignar != null and modoAsignar}" class="mb-3">
        <div class="alert alert-warning-custom alert-custom">
            <h5 class="mb-2"><i class="fas fa-user-plus"></i> Asignar Rutina al Cliente</h5>
            <p class="mb-0"><i class="fas fa-info-circle"></i> Selecciona una rutina para clonar y asignar al cliente.</p>
        </div>
    </div>

    <!-- Mensajes contextuales para cliente -->
    <div th:if="${isCliente != null and isCliente}" class="mb-3">
        <div th:if="${mostrandoGlobales != null and mostrandoGlobales}" class="alert alert-info-custom alert-custom">
            <i class="fas fa-globe"></i> No tienes una rutina activa asignada. Estas son rutinas globales disponibles.
        </div>
        <div th:if="${mostrandoGlobales == null or !mostrandoGlobales}" class="alert alert-success-custom alert-custom">
            <i class="fas fa-check-circle"></i> Estás viendo tu rutina activa.
        </div>
    </div>

    <!-- Botón crear visible para entrenador incluso en modo asignar -->
    <div class="mb-3 text-end" th:if="${isCliente == null or !isCliente}">
        <a th:href="@{/rutinas/nueva}" class="btn btn-crear-rutina">
            <i class="fas fa-plus-circle"></i> Crear Nueva Rutina
        </a>
    </div>

    <table class="table table-bordered table-rutinas bg-white">
        <thead>
        <tr>
            <th style="width:20%">Nombre</th>
            <th style="width:15%">Objetivo</th>
            <th style="width:35%">Descripción</th>
            <th style="width:10%">Semanas</th>
            <th style="width:20%">Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="rutina : ${rutinas}">
            <td><span class="rutina-nombre" th:text="${rutina.nombre}">Rutina</span></td>
            <td>
                <span class="objetivo-badge objetivo-default"
                      th:classappend="${rutina.objetivo != null and #strings.toLowerCase(rutina.objetivo) == 'fuerza'} ? 'objetivo-fuerza' : ''"
                      th:text="${rutina.objetivo}">Objetivo</span>
            </td>
            <td th:text="${rutina.descripcion}">Descripción</td>
            <td>
                <span class="semanas-count">
                    <i class="fas fa-calendar-alt"></i>
                    <span th:text="${rutina.numeroSemanas}">0</span>
                </span>
            </td>
            <td>
                <!-- Vista entrenador normal -->
                <div th:if="${(isCliente == null or !isCliente) and (modoAsignar == null or !modoAsignar)}" class="action-buttons">
                    <a th:href="@{'/semanas/detallar/' + ${rutina.idRutina}}" class="btn btn-sm btn-ver-semanas">
                        <i class="fas fa-layer-group"></i> Semanas
                    </a>
                    <a th:href="@{'/rutinas/editar/' + ${rutina.idRutina}}" class="btn btn-sm btn-editar-rutina">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                    <a th:href="@{'/rutinas/seleccionar-cliente/' + ${rutina.idRutina}}" class="btn btn-sm btn-asignar-rutina">
                        <i class="fas fa-user-plus"></i> Asignar
                    </a>
                    <form th:action="@{'/rutinas/desactivate/' + ${rutina.idRutina}}" method="post" onsubmit="return confirm('¿Eliminar rutina?')">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-sm btn-eliminar-rutina">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </form>
                </div>
                <!-- Vista cliente adoptando global -->
                <div th:if="${isCliente != null and isCliente and mostrandoGlobales != null and mostrandoGlobales}" class="action-buttons">
                    <a th:href="@{'/semanas/detallar/' + ${rutina.idRutina}}" class="btn btn-sm btn-ver-semanas">
                        <i class="fas fa-layer-group"></i> Semanas
                    </a>
                    <form th:action="@{'/rutinas/adoptar/' + ${rutina.idRutina}}" method="post" onsubmit="return confirm('¿Adoptar esta rutina? Se clonará para ti.');">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-sm btn-adoptar-rutina">
                            <i class="fas fa-download"></i> Adoptar
                        </button>
                    </form>
                </div>
                <!-- Modo asignar a cliente desde entrenador -->
                <div th:if="${modoAsignar != null and modoAsignar}" class="action-buttons">
                    <a th:href="@{'/semanas/detallar/' + ${rutina.idRutina}}" class="btn btn-sm btn-ver-semanas" title="Ver semanas">
                        <i class="fas fa-layer-group"></i> Semanas
                    </a>
                    <form th:action="@{'/rutinas/asignar/' + ${rutina.idRutina}}" method="post" onsubmit="return confirm('¿Asignar esta rutina al cliente? Se clonará para él.');">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="hidden" name="idCliente" th:value="${idClienteAsignacion}"/>
                        <button type="submit" class="btn btn-sm btn-asignar-rutina">
                            <i class="fas fa-user-plus"></i> Asignar
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        <tr th:if="${rutinas == null || #lists.isEmpty(rutinas)}">
            <td colspan="5" class="no-rutinas-message">
                <i class="fas fa-dumbbell"></i>
                <p class="mb-0">No hay rutinas disponibles.</p>
            </td>
        </tr>
        </tbody>
    </table>
</section>
</body>
</html>