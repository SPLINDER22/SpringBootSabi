<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout('Dashboard Administrador - SABI', ~{::body})}">

<head>
    <title>Dashboard Administrador - SABI</title>
    <link href="/css/admin.css" rel="stylesheet">
    <style>
        .stat-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
        }
        .progress-bar-animated {
            animation: progress-bar-stripes 1s linear infinite;
        }
        .metric-icon {
            font-size: 3rem;
            opacity: 0.3;
        }
        .quick-action-btn {
            transition: all 0.3s ease;
        }
        .quick-action-btn:hover {
            transform: scale(1.05);
        }
        .activity-item {
            border-left: 3px solid #4e73df;
            padding-left: 15px;
            margin-bottom: 15px;
        }
        .badge-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 115, 223, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(78, 115, 223, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 115, 223, 0); }
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <!-- Page Heading con Saludo Personalizado -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <div>
                <h1 class="h3 mb-0 text-gray-800">
                    <i class="fas fa-tachometer-alt text-primary"></i> Dashboard Administrador
                </h1>
                <p class="text-muted mb-0">Bienvenido, <strong th:text="${#authentication.principal.nombre}">Admin</strong> - Panel de Control del Sistema</p>
            </div>
            <div class="text-right">
                <span class="badge badge-primary badge-pulse px-3 py-2">
                    <i class="fas fa-clock"></i> <span th:text="${#dates.format(#dates.createNow(), 'HH:mm:ss')}"></span>
                </span>
                <br>
                <small class="text-muted" th:text="${#dates.format(#dates.createNow(), 'EEEE, dd MMMM yyyy')}"></small>
            </div>
        </div>

        <!-- Content Row - Estadísticas Principales -->
        <div class="row">
            <!-- Total Usuarios Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Total Usuarios
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${totalUsuarios}">0</div>
                                <small class="text-muted">Usuarios registrados</small>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-users fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Clientes Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    Total Clientes
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${totalClientes}">0</div>
                                <small class="text-muted">Usuarios activos</small>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Entrenadores Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-info shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                    Total Entrenadores
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${totalEntrenadores}">0</div>
                                <small class="text-muted">Profesionales registrados</small>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-dumbbell fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entrenadores Verificados Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    Entrenadores Verificados
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${entrenadoresVerificados}">0</div>
                                <small class="text-muted" th:text="'De ' + ${totalEntrenadores} + ' entrenadores'">Certificados por SABI</small>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-check fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fila de Estadísticas Adicionales -->
        <div class="row">
            <!-- Usuarios Activos vs Bloqueados -->
            <div class="col-xl-6 col-lg-6 mb-4">
                <div class="card shadow h-100">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Estado de Usuarios</h6>
                        <i class="fas fa-chart-pie text-gray-300"></i>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-success"><i class="fas fa-circle"></i> Usuarios Activos</span>
                                <span class="font-weight-bold" th:text="${usuariosActivos}">0</span>
                            </div>
                            <div class="progress mb-3" style="height: 20px;">
                                <div class="progress-bar bg-success" role="progressbar"
                                     th:style="'width: ' + ${totalUsuarios > 0 ? (usuariosActivos * 100.0 / totalUsuarios) : 0} + '%'"
                                     th:text="${totalUsuarios > 0 ? #numbers.formatDecimal((usuariosActivos * 100.0 / totalUsuarios), 1, 1) : 0} + '%'">
                                    0%
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-danger"><i class="fas fa-circle"></i> Usuarios Bloqueados</span>
                                <span class="font-weight-bold" th:text="${usuariosBloqueados}">0</span>
                            </div>
                            <div class="progress mb-3" style="height: 20px;">
                                <div class="progress-bar bg-danger" role="progressbar"
                                     th:style="'width: ' + ${totalUsuarios > 0 ? (usuariosBloqueados * 100.0 / totalUsuarios) : 0} + '%'"
                                     th:text="${totalUsuarios > 0 ? #numbers.formatDecimal((usuariosBloqueados * 100.0 / totalUsuarios), 1, 1) : 0} + '%'">
                                    0%
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="text-center">
                            <h4 class="mb-0" th:text="${totalUsuarios}">0</h4>
                            <small class="text-muted">Total de usuarios en el sistema</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasa de Verificación de Entrenadores -->
            <div class="col-xl-6 col-lg-6 mb-4">
                <div class="card shadow h-100">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-info">Verificación de Entrenadores</h6>
                        <i class="fas fa-certificate text-gray-300"></i>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-success"><i class="fas fa-check-circle"></i> Verificados</span>
                                <span class="font-weight-bold" th:text="${entrenadoresVerificados}">0</span>
                            </div>
                            <div class="progress mb-3" style="height: 20px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" role="progressbar"
                                     th:style="'width: ' + ${totalEntrenadores > 0 ? (entrenadoresVerificados * 100.0 / totalEntrenadores) : 0} + '%'"
                                     th:text="${totalEntrenadores > 0 ? #numbers.formatDecimal((entrenadoresVerificados * 100.0 / totalEntrenadores), 1, 1) : 0} + '%'">
                                    0%
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-warning"><i class="fas fa-clock"></i> Pendientes de Verificar</span>
                                <span class="font-weight-bold" th:text="${entrenadorespendientes}">0</span>
                            </div>
                            <div class="progress mb-3" style="height: 20px;">
                                <div class="progress-bar bg-warning progress-bar-striped" role="progressbar"
                                     th:style="'width: ' + ${totalEntrenadores > 0 ? (entrenadorespendientes * 100.0 / totalEntrenadores) : 0} + '%'"
                                     th:text="${totalEntrenadores > 0 ? #numbers.formatDecimal((entrenadorespendientes * 100.0 / totalEntrenadores), 1, 1) : 0} + '%'">
                                    0%
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="text-center">
                            <h4 class="mb-0" th:text="${totalEntrenadores}">0</h4>
                            <small class="text-muted">Total de entrenadores registrados</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Row - Accesos rápidos y gestión -->
        <div class="row">
            <!-- Accesos Rápidos -->
            <div class="col-lg-8 mb-4">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-gradient-primary text-white">
                        <h6 class="m-0 font-weight-bold"><i class="fas fa-bolt"></i> Accesos Rápidos - Gestión del Sistema</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <a th:href="@{/admin/usuarios}" class="btn btn-primary btn-block btn-lg quick-action-btn shadow-sm">
                                    <i class="fas fa-users fa-2x d-block mb-2"></i>
                                    <strong>Gestionar Usuarios</strong>
                                    <br><small>Ver, bloquear y administrar todos los usuarios</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a th:href="@{/admin/entrenadores}" class="btn btn-info btn-block btn-lg quick-action-btn shadow-sm">
                                    <i class="fas fa-user-check fa-2x d-block mb-2"></i>
                                    <strong>Verificar Entrenadores</strong>
                                    <br><small>Revisar y certificar entrenadores</small>
                                </a>
                            </div>
                        </div>

                        <hr>

                        <!-- Alertas y Notificaciones -->
                        <div class="alert alert-warning" th:if="${entrenadorespendientes > 0}">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>¡Atención!</strong> Tienes <strong th:text="${entrenadorespendientes}">0</strong> entrenador(es) pendiente(s) de verificación.
                            <a th:href="@{/admin/entrenadores}" class="alert-link">Ver ahora</a>
                        </div>

                        <div class="alert alert-info" th:if="${usuariosBloqueados > 0}">
                            <i class="fas fa-info-circle"></i>
                            Hay <strong th:text="${usuariosBloqueados}">0</strong> usuario(s) bloqueado(s) en el sistema.
                            <a th:href="@{/admin/usuarios}" class="alert-link">Ver detalles</a>
                        </div>

                        <div class="alert alert-success" th:if="${entrenadorespendientes == 0 && totalEntrenadores > 0}">
                            <i class="fas fa-check-circle"></i>
                            <strong>¡Excelente!</strong> Todos los entrenadores están verificados.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información del Sistema -->
            <div class="col-lg-4 mb-4">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-gradient-secondary text-white">
                        <h6 class="m-0 font-weight-bold"><i class="fas fa-server"></i> Información del Sistema</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="fas fa-code-branch text-primary"></i>
                            <strong>Versión:</strong> <span class="badge badge-primary">1.3.0</span>
                        </div>
                        <div class="mb-3">
                            <i class="fas fa-calendar text-primary"></i>
                            <strong>Fecha:</strong><br>
                            <span th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                        <div class="mb-3">
                            <i class="fas fa-server text-primary"></i>
                            <strong>Estado:</strong> <span class="badge badge-success">Operativo</span>
                        </div>
                        <div class="mb-3">
                            <i class="fas fa-database text-primary"></i>
                            <strong>Base de Datos:</strong> <span class="text-success">Conectada</span>
                        </div>

                        <hr>

                        <div class="text-center">
                            <img th:src="${#authentication.principal.usuario?.fotoPerfilUrl != null ? #authentication.principal.usuario.fotoPerfilUrl : '/img/fotoPerfil.png'}"
                                 alt="Admin"
                                 class="rounded-circle mb-2"
                                 style="width: 80px; height: 80px; object-fit: cover; border: 3px solid #4e73df;">
                            <h6 class="mb-0" th:text="${#authentication.principal.nombre}">Admin SABI</h6>
                            <small class="text-muted">Administrador del Sistema</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen Rápido -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-gradient-success text-white">
                        <h6 class="m-0 font-weight-bold"><i class="fas fa-chart-line"></i> Resumen del Sistema SABI</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3 mb-3">
                                <div class="border-right">
                                    <h3 class="text-primary mb-0" th:text="${totalUsuarios}">0</h3>
                                    <small class="text-muted">Usuarios Totales</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="border-right">
                                    <h3 class="text-success mb-0" th:text="${totalClientes}">0</h3>
                                    <small class="text-muted">Clientes Activos</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="border-right">
                                    <h3 class="text-info mb-0" th:text="${totalEntrenadores}">0</h3>
                                    <small class="text-muted">Entrenadores</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <h3 class="text-warning mb-0" th:text="${entrenadoresVerificados}">0</h3>
                                <small class="text-muted">Verificados</small>
                            </div>
                        </div>
                        <hr>
                        <p class="text-center mb-0">
                            <i class="fas fa-shield-alt text-success"></i>
                            Sistema de gestión de entrenadores y clientes <strong>SABI</strong> - Versión 1.3.0
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
