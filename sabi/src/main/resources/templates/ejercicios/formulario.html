<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="layout/layout :: layout('Registro de ejercicios',~{::section})">
<body>
<section th:fragment="section">
    <div class="shadow-sm bg-white rounded p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 th:text="${ejercicio.idEjercicio != null ? 'Editar ejercicio' : 'Nuevo ejercicio'}">Registro de ejercicios</h2>
            <a th:if="${fromEjes}"
               th:href="@{'/ejercicios'(fromEjes=true, idDia=${idDia})}"
               class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle me-1"></i>Volver a la lista
            </a>
            <a th:if="${!fromEjes}"
               th:href="@{/ejercicios}"
               class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle me-1"></i>Volver a la lista
            </a>
        </div>

        <form th:action="@{/ejercicios/guardar}"
              th:object="${ejercicio}"
              th:method="post"
              enctype="multipart/form-data">
            <!-- CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" th:field="*{idEjercicio}"/>
            <!-- Contexto -->
            <input type="hidden" name="fromEjes" th:value="${fromEjes}"/>
            <input type="hidden" name="idDia" th:value="${idDia}"/>
            <!-- Imagen existente -->
            <input type="hidden" name="existingImagen" th:value="${ejercicio.urlImagen}"/>

            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre del ejercicio</label>
                <input type="text"
                       id="nombre"
                       th:field="*{nombre}"
                       class="form-control"
                       placeholder="Registra el nombre"
                       required/>
                <div class="text-danger mt-1"
                     th:if="${#fields.hasErrors('nombre')}"
                     th:errors="*{nombre}"></div>
            </div>

            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción del ejercicio</label>
                <textarea id="descripcion"
                       th:field="*{descripcion}"
                       class="form-control"
                       placeholder="Registra la descripción"
                       required></textarea>
                <div class="text-danger mt-1"
                     th:if="${#fields.hasErrors('descripcion')}"
                     th:errors="*{descripcion}"></div>
            </div>

            <div class="mb-3">
                <label for="grupoMuscular" class="form-label">Grupo muscular</label>
                <select id="grupoMuscular"
                        th:field="*{grupoMuscular}"
                        class="form-select"
                        required>
                    <option value="">-- Selecciona --</option>
                    <option value="pecho">Pecho</option>
                    <option value="espalda">Espalda</option>
                    <option value="piernas">Piernas</option>
                    <option value="biceps">Bíceps</option>
                    <option value="triceps">Tríceps</option>
                    <option value="hombros">Hombros</option>
                    <option value="core">Core</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="equipo" class="form-label">Equipo requerido</label>
                <select id="equipo" th:field="*{equipo}" class="form-select" required>
                    <option value="">-- Selecciona --</option>
                    <option value="ninguno">Ninguno / Peso corporal</option>
                    <option value="mancuernas">Mancuernas</option>
                    <option value="barra">Barra con discos</option>
                    <option value="banda">Banda elástica</option>
                    <option value="maquina">Máquina de gimnasio</option>
                    <option value="poleas">Poleas / Cables</option>
                    <option value="kettlebell">Kettlebell (pesa rusa)</option>
                    <option value="balon">Balón medicinal</option>
                    <option value="trx">TRX / Cuerdas de suspensión</option>
                    <option value="step">Step / Caja pliométrica</option>
                    <option value="esterilla">Colchoneta</option>
                    <option value="banco">Banco de pesas</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="urlVideo" class="form-label">Video demostrativo (YouTube - opcional)</label>
                <input type="url"
                       id="urlVideo"
                       th:field="*{urlVideo}"
                       class="form-control"
                       placeholder="https://youtu.be/... o enlace de YouTube"/>
            </div>

            <div class="mb-3">
                <label class="form-label">Imagen de referencia (opcional)</label>
                <div class="mb-2">
                    <input type="file" class="form-control" name="imagenFile" accept="image/*"/>
                </div>
                <div class="border rounded p-2 bg-light" th:if="${ejercicio.urlImagen != null}">
                    <p class="small text-muted mb-2">Imagen actual:</p>
                    <img th:src="${ejercicio.urlImagen}" alt="Imagen actual" style="max-width:200px; height:auto;" class="img-thumbnail"/>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="submit"
                        class="btn btn-success me-2">
                    <i class="bi bi-save me-1"></i>Guardar
                </button>
                <a th:if="${fromEjes}" th:href="@{'/ejercicios'(fromEjes=true, idDia=${idDia})}"
                   class="btn btn-outline-secondary">Cancelar</a>
                <a th:if="${!fromEjes}" th:href="@{/ejercicios}"
                   class="btn btn-outline-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</section>
</body>
</html>