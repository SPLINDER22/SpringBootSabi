<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/layout :: head('Diagn√≥stico', ${['/css/admin.css']}, null)"></head>
<body>
    <div class="dashboard-container">
        <header th:replace="fragments/layout :: navbar"></header>
        <main class="main-content">
            <div class="page-header">
                <div class="header-content">
                    <div class="header-text">
                        <h1 th:if="${isEdit == null}">ü©∫ Nuevo Diagn√≥stico</h1>
                        <h1 th:if="${isEdit != null}">‚úèÔ∏è Editar Diagn√≥stico</h1>
                        <p>Completa tu informaci√≥n para un plan personalizado y seguimiento de tu progreso</p>
                    </div>
                </div>
            </div>

            <!-- Mensajes de retroalimentaci√≥n -->
            <div th:if="${success}" class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                <span th:text="${success}"></span>
            </div>

            <div th:if="${error}" class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}"></span>
            </div>

            <!-- Formulario de diagn√≥stico -->
            <div class="diagnostico-form-section shadow rounded bg-white p-4">
                <form th:if="${isEdit == null}" th:action="@{/cliente/diagnostico/guardar}"
                      th:if="${isEdit != null}" th:action="@{'/cliente/diagnostico/actualizar/' + ${diagnostico.id}}"
                      method="post" th:object="${diagnostico}" class="diagnostico-form">

                    <div class="form-steps">
                        <!-- Paso 1: Informaci√≥n F√≠sica -->
                        <div class="form-step active" id="step-1">
                            <div class="step-header">
                                <h3>‚öñÔ∏è Informaci√≥n F√≠sica</h3>
                                <p>Datos b√°sicos sobre tu condici√≥n f√≠sica actual</p>
                            </div>

                            <div class="form-grid">
                                <div class="form-group shadow rounded">
                                    <label for="peso">
                                        <i class="fas fa-weight-hanging"></i>
                                        Peso (kg) *
                                    </label>
                                    <input type="number" id="peso" th:field="*{peso}" required min="1" class="form-control" />
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('peso')}">
                                        <span th:errors="*{peso}"></span>
                                    </div>
                                </div>

                                <div class="form-group shadow rounded">
                                    <label for="altura">
                                        <i class="fas fa-ruler-vertical"></i>
                                        Estatura (cm) *
                                    </label>
                                    <input type="number" id="altura" th:field="*{estatura}" required min="100" max="250" class="form-control" />
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('estatura')}">
                                        <span th:errors="*{estatura}"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- C√°lculo autom√°tico del IMC -->
                            <div class="imc-calculator">
                                <div class="imc-result">
                                    <h4>Tu IMC: <span id="imc-value">--</span></h4>
                                    <p id="imc-status" class="imc-status"></p>
                                </div>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                                    Siguiente <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Paso 2: Nivel de Actividad -->
                        <div class="form-step" id="step-2">
                            <div class="step-header">
                                <h3>üèÉ‚Äç‚ôÇÔ∏è Nivel de Actividad</h3>
                                <p>¬øQu√© tan activo eres en tu d√≠a a d√≠a?</p>
                            </div>

                            <div class="radio-grid">
                                <div class="radio-option">
                                    <input type="radio" id="sedentario" th:field="*{nivelActividad}" value="SEDENTARIO">
                                    <label for="sedentario" class="radio-card">
                                        <div class="radio-icon">üò¥</div>
                                        <h4>Sedentario</h4>
                                        <p>Trabajo de oficina, poco ejercicio</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="poco-activo" th:field="*{nivelActividad}" value="POCO_ACTIVO">
                                    <label for="poco-activo" class="radio-card">
                                        <div class="radio-icon">üö∂</div>
                                        <h4>Poco Activo</h4>
                                        <p>Ejercicio ligero 1-3 d√≠as/semana</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="moderadamente-activo" th:field="*{nivelActividad}" value="MODERADAMENTE_ACTIVO">
                                    <label for="moderadamente-activo" class="radio-card">
                                        <div class="radio-icon">üèÉ</div>
                                        <h4>Moderadamente Activo</h4>
                                        <p>Ejercicio moderado 3-5 d√≠as/semana</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="muy-activo" th:field="*{nivelActividad}" value="MUY_ACTIVO">
                                    <label for="muy-activo" class="radio-card">
                                        <div class="radio-icon">üí™</div>
                                        <h4>Muy Activo</h4>
                                        <p>Ejercicio intenso 6-7 d√≠as/semana</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="extremadamente-activo" th:field="*{nivelActividad}" value="EXTREMADAMENTE_ACTIVO">
                                    <label for="extremadamente-activo" class="radio-card">
                                        <div class="radio-icon">üèãÔ∏è</div>
                                        <h4>Extremadamente Activo</h4>
                                        <p>Entrenamiento doble, trabajo f√≠sico</p>
                                    </label>
                                </div>
                            </div>

                            <div th:if="${#fields.hasErrors('nivelActividad')}" class="error-message">
                                <span th:errors="*{nivelActividad}"></span>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="btn btn-secondary" onclick="prevStep(1)">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                                    Siguiente <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Paso 3: Experiencia -->
                        <div class="form-step" id="step-3">
                            <div class="step-header">
                                <h3>üèÜ Experiencia con Ejercicio</h3>
                                <p>¬øCu√°l es tu nivel de experiencia?</p>
                            </div>

                            <div class="radio-grid">
                                <div class="radio-option">
                                    <input type="radio" id="principiante" th:field="*{experienciaEjercicio}" value="PRINCIPIANTE">
                                    <label for="principiante" class="radio-card">
                                        <div class="radio-icon">üå±</div>
                                        <h4>Principiante</h4>
                                        <p>Menos de 6 meses de experiencia</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="intermedio" th:field="*{experienciaEjercicio}" value="INTERMEDIO">
                                    <label for="intermedio" class="radio-card">
                                        <div class="radio-icon">üìà</div>
                                        <h4>Intermedio</h4>
                                        <p>6 meses - 2 a√±os de experiencia</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="avanzado" th:field="*{experienciaEjercicio}" value="AVANZADO">
                                    <label for="avanzado" class="radio-card">
                                        <div class="radio-icon">üèÜ</div>
                                        <h4>Avanzado</h4>
                                        <p>M√°s de 2 a√±os de experiencia</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="experto" th:field="*{experienciaEjercicio}" value="EXPERTO">
                                    <label for="experto" class="radio-card">
                                        <div class="radio-icon">üëë</div>
                                        <h4>Experto</h4>
                                        <p>Atleta o instructor profesional</p>
                                    </label>
                                </div>
                            </div>

                            <div th:if="${#fields.hasErrors('experienciaEjercicio')}" class="error-message">
                                <span th:errors="*{experienciaEjercicio}"></span>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(4)">
                                    Siguiente <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Paso 4: Objetivos -->
                        <div class="form-step" id="step-4">
                            <div class="step-header">
                                <h3>üéØ Objetivos</h3>
                                <p>¬øCu√°l es tu objetivo principal?</p>
                            </div>

                            <div class="radio-grid">
                                <div class="radio-option">
                                    <input type="radio" id="perder-peso" th:field="*{objetivos}" value="PERDER_PESO">
                                    <label for="perder-peso" class="radio-card">
                                        <div class="radio-icon">üìâ</div>
                                        <h4>Perder Peso</h4>
                                        <p>Reducir grasa corporal</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="ganar-masa" th:field="*{objetivos}" value="GANAR_MASA_MUSCULAR">
                                    <label for="ganar-masa" class="radio-card">
                                        <div class="radio-icon">üí™</div>
                                        <h4>Ganar M√∫sculo</h4>
                                        <p>Aumentar masa muscular</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="mantener-forma" th:field="*{objetivos}" value="MANTENERSE_EN_FORMA">
                                    <label for="mantener-forma" class="radio-card">
                                        <div class="radio-icon">‚öñÔ∏è</div>
                                        <h4>Mantener Forma</h4>
                                        <p>Conservar condici√≥n actual</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="mejorar-resistencia" th:field="*{objetivos}" value="MEJORAR_RESISTENCIA">
                                    <label for="mejorar-resistencia" class="radio-card">
                                        <div class="radio-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                                        <h4>Mejorar Resistencia</h4>
                                        <p>Aumentar capacidad cardiovascular</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="rehabilitacion" th:field="*{objetivos}" value="REHABILITACION">
                                    <label for="rehabilitacion" class="radio-card">
                                        <div class="radio-icon">üè•</div>
                                        <h4>Rehabilitaci√≥n</h4>
                                        <p>Recuperaci√≥n de lesiones</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="competicion" th:field="*{objetivos}" value="COMPETICION">
                                    <label for="competicion" class="radio-card">
                                        <div class="radio-icon">üèÖ</div>
                                        <h4>Competici√≥n</h4>
                                        <p>Preparaci√≥n deportiva</p>
                                    </label>
                                </div>
                            </div>

                            <div th:if="${#fields.hasErrors('objetivos')}" class="error-message">
                                <span th:errors="*{objetivos}"></span>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="btn btn-secondary" onclick="prevStep(3)">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(5)">
                                    Siguiente <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Paso 5: Preferencias -->
                        <div class="form-step" id="step-5">
                            <div class="step-header">
                                <h3>‚ù§Ô∏è Preferencias de Ejercicio</h3>
                                <p>¬øQu√© tipo de ejercicio prefieres? (Opcional)</p>
                            </div>

                            <div class="radio-grid">
                                <div class="radio-option">
                                    <input type="radio" id="cardio" th:field="*{tipoEjercicioPreferido}" value="CARDIO">
                                    <label for="cardio" class="radio-card">
                                        <div class="radio-icon">üèÉ</div>
                                        <h4>Cardio</h4>
                                        <p>Correr, bicicleta, nataci√≥n</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="fuerza" th:field="*{tipoEjercicioPreferido}" value="FUERZA">
                                    <label for="fuerza" class="radio-card">
                                        <div class="radio-icon">üèãÔ∏è</div>
                                        <h4>Fuerza</h4>
                                        <p>Pesas, calistenia</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="flexibilidad" th:field="*{tipoEjercicioPreferido}" value="FLEXIBILIDAD">
                                    <label for="flexibilidad" class="radio-card">
                                        <div class="radio-icon">üßò</div>
                                        <h4>Flexibilidad</h4>
                                        <p>Yoga, pilates, estiramientos</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="mixto" th:field="*{tipoEjercicioPreferido}" value="MIXTO">
                                    <label for="mixto" class="radio-card">
                                        <div class="radio-icon">üîÑ</div>
                                        <h4>Mixto</h4>
                                        <p>Combinaci√≥n de diferentes tipos</p>
                                    </label>
                                </div>

                                <div class="radio-option">
                                    <input type="radio" id="funcional" th:field="*{tipoEjercicioPreferido}" value="FUNCIONAL">
                                    <label for="funcional" class="radio-card">
                                        <div class="radio-icon">‚ö°</div>
                                        <h4>Funcional</h4>
                                        <p>Movimientos naturales</p>
                                    </label>
                                </div>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="btn btn-secondary" onclick="prevStep(4)">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Guardar Diagn√≥stico
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Progress bar -->
                    <div class="progress-bar">
                        <div class="progress-step active" data-step="1">1</div>
                        <div class="progress-step" data-step="2">2</div>
                        <div class="progress-step" data-step="3">3</div>
                        <div class="progress-step" data-step="4">4</div>
                        <div class="progress-step" data-step="5">5</div>
                    </div>
                </form>
            </div>
        </main>

        <footer th:replace="fragments/layout :: footer"></footer>
    </div>

    <script>
        let currentStep = 1;

        function nextStep(step) {
            if (validateCurrentStep()) {
                document.getElementById('step-' + currentStep).classList.remove('active');
                document.getElementById('step-' + step).classList.add('active');

                // Actualizar progress bar
                document.querySelector('.progress-step[data-step="' + currentStep + '"]').classList.add('completed');
                document.querySelector('.progress-step[data-step="' + step + '"]').classList.add('active');

                currentStep = step;
            }
        }

        function prevStep(step) {
            document.getElementById('step-' + currentStep).classList.remove('active');
            document.getElementById('step-' + step).classList.add('active');

            // Actualizar progress bar
            document.querySelector('.progress-step[data-step="' + currentStep + '"]').classList.remove('active');
            document.querySelector('.progress-step[data-step="' + step + '"]').classList.add('active');

            currentStep = step;
        }

        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    const peso = document.getElementById('peso').value;
                    const altura = document.getElementById('altura').value;
                    if (!peso || !altura) {
                        alert('Por favor, completa peso y altura');
                        return false;
                    }
                    break;
                case 2:
                    if (!document.querySelector('input[name="nivelActividad"]:checked')) {
                        alert('Por favor, selecciona tu nivel de actividad');
                        return false;
                    }
                    break;
                case 3:
                    if (!document.querySelector('input[name="experienciaEjercicio"]:checked')) {
                        alert('Por favor, selecciona tu experiencia con ejercicio');
                        return false;
                    }
                    break;
                case 4:
                    if (!document.querySelector('input[name="objetivos"]:checked')) {
                        alert('Por favor, selecciona tu objetivo principal');
                        return false;
                    }
                    break;
            }
            return true;
        }

        // Calcular IMC autom√°ticamente
        function calcularIMC() {
            const peso = parseFloat(document.getElementById('peso').value);
            const altura = parseFloat(document.getElementById('altura').value);

            if (peso && altura) {
                const imc = peso / (altura * altura);
                const imcValue = document.getElementById('imc-value');
                const imcStatus = document.getElementById('imc-status');

                imcValue.textContent = imc.toFixed(1);

                if (imc < 18.5) {
                    imcStatus.textContent = 'Bajo peso';
                    imcStatus.className = 'imc-status bajo-peso';
                } else if (imc < 25) {
                    imcStatus.textContent = 'Peso normal';
                    imcStatus.className = 'imc-status normal';
                } else if (imc < 30) {
                    imcStatus.textContent = 'Sobrepeso';
                    imcStatus.className = 'imc-status sobrepeso';
                } else {
                    imcStatus.textContent = 'Obesidad';
                    imcStatus.className = 'imc-status obesidad';
                }
            }
        }

        // Event listeners para c√°lculo autom√°tico de IMC
        document.getElementById('peso').addEventListener('input', calcularIMC);
        document.getElementById('altura').addEventListener('input', calcularIMC);

        // Calcular IMC al cargar si hay valores
        document.addEventListener('DOMContentLoaded', calcularIMC);
    </script>
</body>
</html>
