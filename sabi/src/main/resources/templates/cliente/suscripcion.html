<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Mi Suscripción</title>
</head>

<body th:replace="layout/layout :: layout('suscripcion actual', ~{::section})">
    <section th:fragment="section">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 text-dark mb-0">Tu suscripción</h1>
            <a th:href="@{/cliente/suscripcion/historial}" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-history me-1"></i> Ver Tu Historial
            </a>
        </div>
        <div class="container">
            <div class="row justify-content-center">

                <!-- Estado vacío: sin suscripción actual -->
                <div th:if="${suscripcion == null}" class="col-12 d-flex justify-content-center">
                    <div class="alert alert-info text-center w-50 mt-5" role="alert">
                        <strong>No tienes una suscripción activa.</strong><br>
                        Solicita un entrenador para crear una suscripción.
                        <div class="mt-3 d-flex gap-2 justify-content-center">
                            <a th:href="@{/cliente/listaEntrenadores}" class="btn btn-primary me-3">Ver entrenadores</a>
                        </div>
                    </div>
                </div>
                <!-- Suscripción actual -->
                <div th:if="${suscripcion != null}" class="col-12 col-lg-10 col-xl-8 mx-auto mb-5">
                    <div class="card w-100 shadow-lg border-primary rounded-5 text-center">
                        <div class="card-header bg-primary">
                            <h4 class="text-dark mb-0">Detalles de la Suscripción</h4>
                        </div>
                        <div class="card-body py-4">
                            <div class="d-flex flex-column align-items-center mb-4">
                                <h3 class="card-title fw-semibold mb-2">Entrenador: <strong
                                        th:text="${nombreEntrenador} ?: 'Nombre Entrenador'">Nombre Entrenador</strong>
                                </h3>
                                <span class="text-dark">Este es el estado Actual de tu suscripción</span><span
                                    class="badge rounded-pill px-3 py-2 text-uppercase fs-6"
                                    th:text="${suscripcion.estadoSuscripcion}"
                                    th:classappend="${suscripcion.estadoSuscripcion == 'ACEPTADA' ? ' bg-success' : (suscripcion.estadoSuscripcion == 'COTIZADA' ? ' bg-info text-dark' : (suscripcion.estadoSuscripcion == 'RECHAZADA' ? ' bg-danger' : (suscripcion.estadoSuscripcion == 'PENDIENTE' ? ' bg-warning text-dark' : (suscripcion.estadoSuscripcion == 'CANCELADA' ? ' bg-secondary' : ' bg-light text-dark'))))}">
                                    Estado
                                </span>

                            </div>

                            <div class="row g-3 g-md-4 justify-content-center">
                                <div class="col-12 col-md-4">
                                    <div class="d-flex flex-column align-items-center p-3">
                                        <div class="fs-5 text-dark mb-1"><i class="fas fa-dollar-sign text-primary me-2"></i> Precio</div>
                                        <div class="fw-semibold fs-5" th:text="${suscripcion.precio != null ? #numbers.formatDecimal(suscripcion.precio, 1, 'COMMA', 2, 'POINT') : 'Por Definirse'}">Por Definirse</div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="d-flex flex-column align-items-center p-3">
                                        <div class="fs-5 text-dark mb-1">
                                            <i class="fas fa-play text-primary me-2"></i> Fecha de Inicio
                                        </div>
                                        <div class="fw-semibold fs-5"
                                            th:text="${suscripcion.fechaInicio != null ? #temporals.format(suscripcion.fechaInicio, 'yyyy-MM-dd') : 'Por Definirse'}">
                                            Por Definirse</div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="d-flex flex-column align-items-center p-3">
                                        <div class="fs-5 text-dark mb-1">
                                            <i class="fas fa-flag-checkered text-primary me-2"></i> Fecha de Fin
                                        </div>
                                        <div class="fw-semibold fs-5"
                                            th:text="${suscripcion.fechaFin != null ? #temporals.format(suscripcion.fechaFin, 'yyyy-MM-dd') : 'Por Definirse'}">
                                            Por Definirse</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-primary pt-3 pb-4">
                            <div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-3">
                                <form
                                    th:if="${suscripcion.estadoSuscripcion == T(com.sabi.sabi.entity.enums.EstadoSuscripcion).COTIZADA}"
                                    th:action="@{/suscripciones/pagar/{id}(id=${suscripcion.idSuscripcion})}"
                                    method="post" class="mb-0">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <input type="hidden" name="redirectTo" value="/cliente/suscripcion" />
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <i class="fas fa-credit-card me-1"></i> Pagar
                                    </button>
                                </form>
                                <form th:if="${suscripcion.estadoSuscripcion != 'RECHAZADA'}"
                                    th:action="@{/cliente/suscripcion/cancelar/{id}(id=${suscripcion.idSuscripcion})}"
                                    method="post" class="mb-0">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button type="submit" class="btn btn-danger btn-lg"><i class="fas fa-ban me-1"></i>
                                        Cancelar suscripción</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
</body>

</html>