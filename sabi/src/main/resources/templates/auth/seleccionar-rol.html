<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Seleccionar Rol - SABI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="page-wrapper">
<!-- Topbar con nombre y expansión -->
<div class="topbar">
    <div class="container topbar-inner">
        <div class="topbar-title">SABI <span class="topbar-sub">Salud y Bienestar</span></div>
        <!-- navegación eliminada en flujo de registro -->
    </div>
</div>

<form action="/auth/seleccionar-rol" method="post" class="roles-page">
    <div class="roles-content container">
        <!-- Progress indicator -->
        <div class="progress-steps">
            <div class="step completed">
                <div class="step-circle">✓</div>
                <span class="step-label">Registro</span>
            </div>
            <div class="step-line"></div>
            <div class="step active">
                <div class="step-circle">2</div>
                <span class="step-label">Seleccionar Rol</span>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">3</div>
                <span class="step-label">Completar Perfil</span>
            </div>
        </div>

        <div class="roles-hero" role="banner" aria-hidden="false">
            <h1 class="logo">SABI</h1>
            <p class="hero-sub" style="margin-top:.4rem;">Elige el rol que mejor describe tu objetivo. Esta decisión es permanente.</p>
        </div>

        <div class="roles-panel">
            <div class="roles-grid">
                <div class="role-card role-customer" tabindex="0" role="button" aria-pressed="false" onclick="selectRole(this, 'CLIENTE')">
                    <div class="selection-indicator">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path class="checkmark" d="M7 12l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="role-header">
                        <!-- Icono persona -->
                        <svg class="role-icon" width="56" height="56" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2.4c-3.3 0-9.9 1.7-9.9 5v1.2c0 .6.5 1.1 1.1 1.1h17.6c.6 0 1.1-.5 1.1-1.1V19.4c0-3.3-6.6-5-9.9-5z"/>
                        </svg>
                        <h2>Cliente</h2>
                        <p class="role-tag">Rutinas • Seguimiento • Diagnósticos</p>
                    </div>
                    <p class="role-desc"><strong>Transforma tu vida.</strong> Accede a planes personalizados, registra tu progreso y conecta con entrenadores.</p>
                    <ul class="role-list">
                        <li>Rutinas hechas para ti</li>
                        <li>Registro y evolución visual</li>
                        <li>Diagnóstico y recomendaciones</li>
                    </ul>
                    <div class="role-badge">Ideal para usuarios</div>
                 </div>

                <div class="role-card role-trainer" tabindex="0" role="button" aria-pressed="false" onclick="selectRole(this, 'ENTRENADOR')">
                    <div class="selection-indicator">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path class="checkmark" d="M7 12l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="role-header">
                        <!-- Icono entrenador (pesas) -->
                        <svg class="role-icon" width="56" height="56" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M21 7h-1.5L17 4.5 15.5 6 18 8.5V10h1V9h1v2h-1v1h-1v-1h-1v2h1v1h1v-1h1v1h1V7zM3 7h1v6H3V7zm3 0h1v6H6V7zm2 0h1v6H8V7zM11 7h2v6h-2V7z"/>
                        </svg>
                        <h2>Entrenador</h2>
                        <p class="role-tag">Gestión • Diagnóstico • Comunidad</p>
                    </div>
                    <p class="role-desc"><strong>Impulsa tu carrera.</strong> Gestiona clientes, crea rutinas y monitoriza resultados profesionalmente.</p>
                    <ul class="role-list">
                        <li>Gestión integral de clientes</li>
                        <li>Panel de resultados y evolución</li>
                        <li>Comunicación directa con tus clientes</li>
                    </ul>
                    <div class="role-badge role-badge-trainer">Ideal para profesionales</div>
                </div>
            </div>
            <!-- Input hidden para enviar el rol seleccionado -->
            <input type="hidden" name="rol" id="rolInput" value="">
ue            <!-- Token CSRF de Spring Security -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        </div>

        <div class="info-banner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                <path d="M12 16v-4M12 8h.01" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <p><strong>Importante:</strong> No podrás cambiar tu rol después. Si seleccionas Entrenador, te pediremos información adicional de certificación.</p>
        </div>
    </div>
</form>

<!-- Footer sencillo (coherente con index) -->
<footer class="footer footer-small">
    <div class="container">
        <p>&copy; 2025 SABI. Salud y Bienestar.</p>
    </div>
</footer>
</div>

<script>
    // Animación de entrada para las tarjetas
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.role-card');
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.classList.add('animate-in');
            }, index * 150);
        });
    });

    // Función para seleccionar rol con confirmación SweetAlert2
    function selectRole(card, rolValue) {
        // Prevenir cualquier acción predeterminada
        event.preventDefault();
        event.stopPropagation();

        // Remover selección previa
        document.querySelectorAll('.role-card').forEach(c => {
            c.classList.remove('selected');
        });

        // Añadir selección visual temporal
        card.classList.add('selected');

        // Determinar el rol y configurar el mensaje personalizado
        const isCliente = rolValue === 'CLIENTE';
        const roleName = isCliente ? 'Cliente' : 'Entrenador';
        const rolColor = isCliente ? '#2a7ae4' : '#ff7043';
        const roleIcon = isCliente ? 'question' : 'warning';

        const confirmText = isCliente
            ? '¿Estás seguro de que quieres registrarte como <strong>Cliente</strong>?<br><br>Tendrás acceso a rutinas personalizadas, seguimiento de progreso y conexión con entrenadores profesionales.'
            : '¿Estás seguro de que quieres registrarte como <strong>Entrenador</strong>?<br><br><small>⚠️ Se te pedirá información adicional sobre tu experiencia y certificaciones.</small>';

        // Mostrar SweetAlert2 de confirmación
        Swal.fire({
            title: `Confirmar rol: ${roleName}`,
            html: confirmText,
            icon: roleIcon,
            iconColor: rolColor,
            showCancelButton: true,
            confirmButtonColor: rolColor,
            cancelButtonColor: '#6b7280',
            confirmButtonText: `Sí, quiero ser ${roleName}`,
            cancelButtonText: 'Cancelar',
            reverseButtons: true,
            focusConfirm: false,
            allowOutsideClick: false,
            customClass: {
                popup: 'swal-custom-popup',
                title: 'swal-custom-title',
                confirmButton: 'swal-custom-confirm',
                cancelButton: 'swal-custom-cancel'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                // Usuario confirmó: establecer el valor del rol y mostrar loading
                document.getElementById('rolInput').value = rolValue;

                Swal.fire({
                    title: 'Procesando...',
                    html: `Configurando tu cuenta como <strong>${roleName}</strong>`,
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // Enviar formulario después de un pequeño delay
                setTimeout(() => {
                    document.querySelector('.roles-page').submit();
                }, 800);
            } else {
                // Usuario canceló: remover selección visual
                card.classList.remove('selected');
            }
        });
    }

    // Accesibilidad: permitir activar con Enter/Space
    document.querySelectorAll('.role-card').forEach(function(card){
        card.addEventListener('keydown', function(e){
            if(e.key === 'Enter' || e.key === ' '){
                e.preventDefault();
                card.click();
            }
        });
    });
</script>
</body>
</html>
